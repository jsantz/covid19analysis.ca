let state,explorer,infected,healthy,chimes,exit,player,dungeon,immune,healthBar,message,gameScene,gameOverScene,enemies,id,Application=PIXI.Application,Container=PIXI.Container,loader=PIXI.loader,resources=PIXI.loader.resources,Graphics=PIXI.Graphics,TextureCache=PIXI.utils.TextureCache,Sprite=PIXI.Sprite,Text=PIXI.Text,TextStyle=PIXI.TextStyle,Radius=10,populations=200,naturalImmunity=1,riskpop=1,bump=!1,transmissibility=100,socialSpeed=1,infectionLength=300,sample=30,timeline=0,healthyset=[],immuneset=[],infectedset=[],xvals=[],quarantineLevel=0,app=new Application({width:710,height:710,antialiasing:!0,transparent:!1,resolution:1});function renderScene(){document.body.appendChild(app.view),loader.add("images/pandemic.json"),loader.load(setup)}function setup(){gameScene=new Container,app.stage.addChild(gameScene),id=resources["images/pandemic.json"].textures,dungeon=new Sprite(id["area.png"]),gameScene.addChild(dungeon),(explorer=new Sprite(id["explorer.png"])).x=68,explorer.y=gameScene.height/2-explorer.height/2,explorer.vx=0,explorer.vy=0;let e=socialSpeed,t=3;immunes=[];let n=naturalImmunity;for(let i=0;i<n;i++){immune=new Sprite(id["immune.png"]);let n=randomInt(0,app.stage.width-immune.width),i=randomInt(0,app.stage.height-immune.height);immune.x=n,immune.y=i,immune.vy=e*randomInt(-3,3),immune.vx=e*randomInt(-3,3),t*=-1,immunes.push(immune),gameScene.addChild(immune)}let i=riskpop;infecteds=[];for(let n=0;n<i;n++){infected=new Sprite(id["infected.png"]);let n=randomInt(0,app.stage.width-infected.width),i=randomInt(0,app.stage.height-infected.height);infected.x=n,infected.y=i,infected.vy=e*randomInt(-3,3),infected.vx=e*randomInt(-3,3),infected.infection=infectionLength,t*=-1,infecteds.push(infected),gameScene.addChild(infected)}let a=populations;healthys=[];for(let n=0;n<a;n++){let n=new Sprite(id["healthy.png"]),i=randomInt(0,700-n.width),a=randomInt(0,700-n.height);n.x=i,n.y=a,isQuarantined()?(n.vy=0,n.vx=0):(n.vy=e*randomInt(-3,3),n.vx=e*randomInt(-3,3)),t*=-1,healthys.push(n),gameScene.addChild(n)}gameOverScene=new Container,app.stage.addChild(gameOverScene),gameOverScene.visible=!1;new TextStyle({fontFamily:"Futura",fontSize:64,fill:"white"});state=play,app.ticker.add(e=>gameLoop(e))}function gameLoop(e){state(e)}function play(e){sample--,explorer.x+=explorer.vx,explorer.y+=explorer.vy,contain(explorer,{x:28,y:10,width:700,height:700});healthys.forEach(function(e){e.y+=e.vy,e.x+=e.vx;let t=contain(e,{x:28,y:10,width:700,height:700});"top"!==t&&"bottom"!==t||(e.vy*=-1),"left"!==t&&"right"!==t||(e.vx*=-1),healthys.forEach(function(t){hitTestRectangle(e,t,Radius)&&bump&&(e.vx*=-1,e.vy*=-1,t.vx*=-1,t.vy*=-1)})}),infecteds.forEach(function(e,t,n){e.y+=e.vy,e.x+=e.vx;let i=contain(e,{x:28,y:10,width:700,height:700});if("top"!==i&&"bottom"!==i||(e.vy*=-1),"left"!==i&&"right"!==i||(e.vx*=-1),infecteds.forEach(function(t){hitTestRectangle(e,t,Radius)&&bump&&(e.vx*=-1,e.vy*=-1,t.vx*=-1,t.vy*=-1)}),healthys.forEach(function(t,n,i){if(hitTestRectangle(e,t,Radius)){let a;transmission()&&((a=new Sprite(id["infected.png"])).x=t.x,a.y=t.y,a.vy=t.vy,a.vx=t.vx,a.infection=infectionLength,infecteds.push(a),i.splice(n,1),gameScene.addChild(a),gameScene.removeChild(t)),bump&&(e.vx*=-1,e.vy*=-1,t.vx*=-1,t.vy*=-1),healtys=i}}),e.infection--,!e.infection){let i;(i=new Sprite(id["immune.png"])).x=e.x,i.y=e.y,i.vy=e.vy,i.vx=e.vx,i.infection=30,immunes.push(i),n.splice(t,1),gameScene.addChild(i),gameScene.removeChild(e)}infecteds=n}),immunes.forEach(function(e){e.y+=e.vy,e.x+=e.vx;let t=contain(e,{x:28,y:10,width:700,height:700});"top"!==t&&"bottom"!==t||(e.vy*=-1),"left"!==t&&"right"!==t||(e.vx*=-1),immunes.forEach(function(t){hitTestRectangle(e,t,Radius)&&bump&&(e.vx*=-1,e.vy*=-1,t.vx*=-1,t.vy*=-1)})}),explorer.alpha=1,hitTestRectangle(explorer,infected,Radius)&&(infected.x=explorer.x+8,infected.y=explorer.y+8),0==infecteds.length&&(state=end),sample||(sample=30,healthyset[timeline]={t:timeline,y:healthys.length},infectedset[timeline]={t:timeline,y:infecteds.length},immuneset[timeline]={t:timeline,y:immunes.length},xvals[timeline]=timeline,window.myLine.update(),timeline++)}function end(){}function transmission(){return Math.random()<transmissibility/100}function contain(e,t){let n=void 0;return e.x<t.x&&(e.x=t.x,n="left"),e.y<t.y&&(e.y=t.y,n="top"),e.x+e.width>t.width&&(e.x=t.width-e.width,n="right"),e.y+e.height>t.height&&(e.y=t.height-e.height,n="bottom"),n}function hitTestRectangle(e,t,n){let i,a,o,l,d;return i=!1,e.centerX=e.x+e.width/2,e.centerY=e.y+e.height/2,t.centerX=t.x+t.width/2,t.centerY=t.y+t.height/2,e.halfWidth=e.width/2,e.halfHeight=e.height/2,t.halfWidth=t.width/2,t.halfHeight=t.height/2,l=e.centerX-t.centerX,d=e.centerY-t.centerY,a=n,o=n,i=Math.abs(l)<a&&Math.abs(d)<o}function randomInt(e,t){let n=Math.random();return 0===n&&(n=1),Math.floor(n*(t-e+1))+e}function keyboard(e){var t={};return t.code=e,t.isDown=!1,t.isUp=!0,t.press=void 0,t.release=void 0,t.downHandler=function(e){e.keyCode===t.code&&(t.isUp&&t.press&&t.press(),t.isDown=!0,t.isUp=!1),e.preventDefault()},t.upHandler=function(e){e.keyCode===t.code&&(t.isDown&&t.release&&t.release(),t.isDown=!1,t.isUp=!0),e.preventDefault()},window.addEventListener("keydown",t.downHandler.bind(t),!1),window.addEventListener("keyup",t.upHandler.bind(t),!1),t}renderScene();var config={type:"line",data:{labels:xvals,datasets:[{label:"Healthy",borderColor:"#4383cc",backgroundColor:"#8ab2df",data:healthyset},{label:"Infected",borderColor:"#FF0000",backgroundColor:"#FFaf30",data:infectedset},{label:"Immune",borderColor:"#a4c15b",backgroundColor:"#c6d899",data:immuneset}]},options:{responsive:!0,title:{display:!0,text:"Population Changes"},tooltips:{mode:"index"},hover:{mode:"index"},scales:{xAxes:[{distribution:"series",offset:!0,labelString:"Epoch",ticks:{major:{enabled:!0,fontStyle:"bold"},source:"data",autoSkip:!0,autoSkipPadding:75,maxRotation:0,sampleSize:100}}],yAxes:[{stacked:!1,scaleLabel:{display:!0,labelString:"Population"}}]}}};function isQuarantined(){return Math.random()<quarantineLevel/100}var ctx=document.getElementById("canvas").getContext("2d");window.myLine=new Chart(ctx,config),$("#runsimulation").click(function(){bump=$("#isBounce").is(":checked"),populations=$("#slider-range-min").slider("value"),transmissibility=$("#transmissibility").slider("value"),socialSpeed=$("#movementspd").slider("value")/100,quarantineLevel=$("#shelter").slider("value"),Radius=$("#radius").slider("value"),infectionLength=30*$("#infectionTime").slider("value"),app.destroy(!0),app=null,loader.reset(),app=new Application({width:710,height:710,antialiasing:!0,transparent:!1,resolution:1}),timeline=0;var e={type:"line",data:{labels:xvals=[],datasets:[{label:"Healthy",borderColor:"#4383cc",backgroundColor:"#8ab2df",data:healthyset=[]},{label:"Infected",borderColor:"#FF0000",backgroundColor:"#FFaf30",data:infectedset=[]},{label:"Immune",borderColor:"#a4c15b",backgroundColor:"#c6d899",data:immuneset=[]}]},options:{responsive:!0,title:{display:!0,text:"Population Changes"},tooltips:{mode:"index"},hover:{mode:"index"},scales:{xAxes:[{distribution:"series",offset:!0,labelString:"Epoch",ticks:{major:{enabled:!0,fontStyle:"bold"},source:"data",autoSkip:!0,autoSkipPadding:75,maxRotation:0,sampleSize:100}}],yAxes:[{stacked:!1,scaleLabel:{display:!0,labelString:"Population"}}]}}},t=document.getElementById("canvas").getContext("2d");window.myLine=new Chart(t,e),renderScene()});