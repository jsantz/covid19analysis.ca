let state,explorer,infected,healthy,chimes,exit,player,dungeon,immune,healthBar,message,gameScene,gameOverScene,enemies,id,Application=PIXI.Application,Container=PIXI.Container,loader=PIXI.loader,resources=PIXI.loader.resources,Graphics=PIXI.Graphics,TextureCache=PIXI.utils.TextureCache,Sprite=PIXI.Sprite,Text=PIXI.Text,TextStyle=PIXI.TextStyle,Radius=10,populations=200,naturalImmunity=1,riskpop=1,bump=!1,transmissibility=100,socialSpeed=1,infectionLength=300,sample=30,timeline=0,healthyset=[],immuneset=[],infectedset=[],xvals=[],quarantineLevel=0,app=new Application({width:710,height:710,antialiasing:!0,transparent:!1,resolution:1});function renderScene(){document.body.appendChild(app.view),loader.add("images/pandemic.json"),loader.load(setup)}function setup(){gameScene=new Container,app.stage.addChild(gameScene),id=resources["images/pandemic.json"].textures,dungeon=new Sprite(id["area.png"]),gameScene.addChild(dungeon),(explorer=new Sprite(id["explorer.png"])).x=68,explorer.y=gameScene.height/2-explorer.height/2,explorer.vx=0,explorer.vy=0;let e=socialSpeed,t=3;immunes=[];let i=naturalImmunity;for(let n=0;n<i;n++){immune=new Sprite(id["immune.png"]);let i=randomInt(0,app.stage.width-immune.width),n=randomInt(0,app.stage.height-immune.height);immune.x=i,immune.y=n,immune.vy=e*randomInt(-3,3),immune.vx=e*randomInt(-3,3),t*=-1,immunes.push(immune),gameScene.addChild(immune)}let n=riskpop;infecteds=[];for(let i=0;i<n;i++){infected=new Sprite(id["infected.png"]);let i=randomInt(0,app.stage.width-infected.width),n=randomInt(0,app.stage.height-infected.height);infected.x=i,infected.y=n,infected.vy=e*randomInt(-3,3),infected.vx=e*randomInt(-3,3),infected.infection=infectionLength,t*=-1,infecteds.push(infected),gameScene.addChild(infected)}let a=populations;healthys=[];for(let i=0;i<a;i++){let i=new Sprite(id["healthy.png"]),n=randomInt(0,700-i.width),a=randomInt(0,700-i.height);i.x=n,i.y=a,isQuarantined()?(i.vy=0,i.vx=0):(i.vy=e*randomInt(-3,3),i.vx=e*randomInt(-3,3)),t*=-1,healthys.push(i),gameScene.addChild(i)}gameOverScene=new Container,app.stage.addChild(gameOverScene),gameOverScene.visible=!1,new TextStyle({fontFamily:"Futura",fontSize:64,fill:"white"}),state=play,app.ticker.add(e=>gameLoop(e))}function gameLoop(e){state(e)}function play(e){sample--,explorer.x+=explorer.vx,explorer.y+=explorer.vy,contain(explorer,{x:28,y:10,width:700,height:700}),healthys.forEach(function(e){e.y+=e.vy,e.x+=e.vx;let t=contain(e,{x:28,y:10,width:700,height:700});"top"!==t&&"bottom"!==t||(e.vy*=-1),"left"!==t&&"right"!==t||(e.vx*=-1),healthys.forEach(function(t){hitTestRectangle(e,t,Radius)&&bump&&(e.vx*=-1,e.vy*=-1,t.vx*=-1,t.vy*=-1)})}),infecteds.forEach(function(e,t,i){e.y+=e.vy,e.x+=e.vx;let n=contain(e,{x:28,y:10,width:700,height:700});if("top"!==n&&"bottom"!==n||(e.vy*=-1),"left"!==n&&"right"!==n||(e.vx*=-1),infecteds.forEach(function(t){hitTestRectangle(e,t,Radius)&&bump&&(e.vx*=-1,e.vy*=-1,t.vx*=-1,t.vy*=-1)}),healthys.forEach(function(t,i,n){if(hitTestRectangle(e,t,Radius)){let a;transmission()&&((a=new Sprite(id["infected.png"])).x=t.x,a.y=t.y,a.vy=t.vy,a.vx=t.vx,a.infection=infectionLength,infecteds.push(a),n.splice(i,1),gameScene.addChild(a),gameScene.removeChild(t)),bump&&(e.vx*=-1,e.vy*=-1,t.vx*=-1,t.vy*=-1),healtys=n}}),e.infection--,!e.infection){let n;(n=new Sprite(id["immune.png"])).x=e.x,n.y=e.y,n.vy=e.vy,n.vx=e.vx,n.infection=30,immunes.push(n),i.splice(t,1),gameScene.addChild(n),gameScene.removeChild(e)}infecteds=i}),immunes.forEach(function(e){e.y+=e.vy,e.x+=e.vx;let t=contain(e,{x:28,y:10,width:700,height:700});"top"!==t&&"bottom"!==t||(e.vy*=-1),"left"!==t&&"right"!==t||(e.vx*=-1),immunes.forEach(function(t){hitTestRectangle(e,t,Radius)&&bump&&(e.vx*=-1,e.vy*=-1,t.vx*=-1,t.vy*=-1)}),healthys.forEach(function(t){hitTestRectangle(e,t,Radius)&&bump&&(e.vx*=-1,e.vy*=-1,t.vx*=-1,t.vy*=-1)}),infecteds.forEach(function(t){hitTestRectangle(e,t,Radius)&&bump&&(e.vx*=-1,e.vy*=-1,t.vx*=-1,t.vy*=-1)})}),explorer.alpha=1,hitTestRectangle(explorer,infected,Radius)&&(infected.x=explorer.x+8,infected.y=explorer.y+8),0==infecteds.length&&(state=end),sample||(sample=30,healthyset[timeline]={t:timeline,y:healthys.length},infectedset[timeline]={t:timeline,y:infecteds.length},immuneset[timeline]={t:timeline,y:immunes.length},xvals[timeline]=timeline,window.myLine.update(),timeline++)}function end(){}function transmission(){return Math.random()<transmissibility/100}function contain(e,t){let i=void 0;return e.x<t.x&&(e.x=t.x,i="left"),e.y<t.y&&(e.y=t.y,i="top"),e.x+e.width>t.width&&(e.x=t.width-e.width,i="right"),e.y+e.height>t.height&&(e.y=t.height-e.height,i="bottom"),i}function hitTestRectangle(e,t,i){let n,a,l,o,r;return n=!1,e.centerX=e.x+e.width/2,e.centerY=e.y+e.height/2,t.centerX=t.x+t.width/2,t.centerY=t.y+t.height/2,e.halfWidth=e.width/2,e.halfHeight=e.height/2,t.halfWidth=t.width/2,t.halfHeight=t.height/2,o=e.centerX-t.centerX,r=e.centerY-t.centerY,a=i,l=i,Math.abs(o)<a&&Math.abs(r)<l}function randomInt(e,t){let i=Math.random();return 0===i&&(i=1),Math.floor(i*(t-e+1))+e}function keyboard(e){var t={};return t.code=e,t.isDown=!1,t.isUp=!0,t.press=void 0,t.release=void 0,t.downHandler=function(e){e.keyCode===t.code&&(t.isUp&&t.press&&t.press(),t.isDown=!0,t.isUp=!1),e.preventDefault()},t.upHandler=function(e){e.keyCode===t.code&&(t.isDown&&t.release&&t.release(),t.isDown=!1,t.isUp=!0),e.preventDefault()},window.addEventListener("keydown",t.downHandler.bind(t),!1),window.addEventListener("keyup",t.upHandler.bind(t),!1),t}renderScene();var config={type:"line",data:{labels:xvals,datasets:[{label:"Immune",borderColor:"#a4c15b",backgroundColor:"#c6d899",data:immuneset},{label:"Infected",borderColor:"#FF0000",backgroundColor:"#FFaf30",data:infectedset},{label:"Healthy",borderColor:"#4383cc",backgroundColor:"#8ab2df",data:healthyset}]},options:{responsive:!0,title:{display:!0,text:"Population Changes"},tooltips:{mode:"index"},hover:{mode:"index"},scales:{xAxes:[{distribution:"series",offset:!0,labelString:"Epoch",ticks:{major:{enabled:!0,fontStyle:"bold"},source:"data",autoSkip:!0,autoSkipPadding:75,maxRotation:0,sampleSize:100}}],yAxes:[{stacked:!1,scaleLabel:{display:!0,labelString:"Population"}}]}}};function isQuarantined(){return Math.random()<quarantineLevel/100}var ctx=document.getElementById("canvas").getContext("2d");window.myLine=new Chart(ctx,config),$("#runsimulation").click(function(){bump=$("#isBounce").is(":checked"),populations=$("#slider-range-min").slider("value"),transmissibility=$("#transmissibility").slider("value"),socialSpeed=$("#movementspd").slider("value")/100,quarantineLevel=$("#shelter").slider("value"),Radius=$("#radius").slider("value"),infectionLength=30*$("#infectionTime").slider("value"),app.destroy(!0),app=null,loader.reset(),app=new Application({width:710,height:710,antialiasing:!0,transparent:!1,resolution:1}),timeline=0;var e={type:"line",data:{labels:xvals=[],datasets:[{label:"Healthy",borderColor:"#4383cc",backgroundColor:"#8ab2df",data:healthyset=[]},{label:"Infected",borderColor:"#FF0000",backgroundColor:"#FFaf30",data:infectedset=[]},{label:"Immune",borderColor:"#a4c15b",backgroundColor:"#c6d899",data:immuneset=[]}]},options:{responsive:!0,title:{display:!0,text:"Population Changes"},tooltips:{mode:"index"},hover:{mode:"index"},scales:{xAxes:[{distribution:"series",offset:!0,labelString:"Epoch",ticks:{major:{enabled:!0,fontStyle:"bold"},source:"data",autoSkip:!0,autoSkipPadding:75,maxRotation:0,sampleSize:100}}],yAxes:[{stacked:!1,scaleLabel:{display:!0,labelString:"Population"}}]}}},t=document.getElementById("canvas").getContext("2d");window.myLine=new Chart(t,e),renderScene()}),$(function(){var e=$("#custom-handle");$("#slider-range-min").slider({range:"min",value:200,min:50,max:400,create:function(){e.text($(this).slider("value"))},slide:function(t,i){$("#amount").val(i.value),e.text(i.value)}}),$("#amount").val(+$("#slider-range-min").slider("value"))}),$(function(){var e=$("#transmissibility-handle");$("#transmissibility").slider({range:"min",value:20,min:1,max:100,create:function(){e.text($(this).slider("value"))},slide:function(t,i){$("#transmissibility-label").val("% "+i.value),e.text("%"+i.value)}}),$("#transmissibility-label").val("% "+$("#transmissibility").slider("value"))}),$(function(){var e=$("#movementspd-handle");$("#movementspd").slider({range:"min",value:100,min:1,max:200,create:function(){e.text($(this).slider("value"))},slide:function(t,i){$("#movementspd-label").val("% "+i.value),e.text("%"+i.value)}}),$("#movementspd-label").val("% "+$("#movementspd").slider("value"))}),$(function(){var e=$("#shelter-handle");$("#shelter").slider({range:"min",value:0,min:0,max:100,create:function(){e.text($(this).slider("value"))},slide:function(t,i){$("#shelter-label").val("% "+i.value),e.text("%"+i.value)}}),$("#shelter-label").val("% "+$("#shelter").slider("value"))}),$(function(){var e=$("#radius-handle");$("#radius").slider({range:"min",value:10,min:1,max:20,create:function(){e.text($(this).slider("value"))},slide:function(t,i){$("#radius-label").val(i.value),e.text(i.value)}}),$("#radius-label").val($("#radius").slider("value"))}),$(function(){var e=$("#infectionTime-handle");$("#infectionTime").slider({range:"min",value:10,min:1,max:30,create:function(){e.text($(this).slider("value"))},slide:function(t,i){$("#infectionTime-label").val(i.value),e.text(i.value)}}),$("#infectionTime-label").val($("#infectionTime").slider("value"))});