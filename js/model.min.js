let state,explorer,infected,healthy,chimes,exit,player,dungeon,immune,healthBar,message,gameScene,gameOverScene,enemies,id,Application=PIXI.Application,Container=PIXI.Container,loader=PIXI.loader,resources=PIXI.loader.resources,Graphics=PIXI.Graphics,TextureCache=PIXI.utils.TextureCache,Sprite=PIXI.Sprite,Text=PIXI.Text,TextStyle=PIXI.TextStyle,Radius=10,populations=200,naturalImmunity=1,riskpop=1,bump=!1,transmissibility=100,socialSpeed=1,infectionLength=300,app=new Application({width:710,height:710,antialiasing:!0,transparent:!1,resolution:1});function renderScene(){document.body.appendChild(app.view),loader.add("images/pandemic.json").load(setup)}function setup(){gameScene=new Container,app.stage.addChild(gameScene),id=resources["images/pandemic.json"].textures,dungeon=new Sprite(id["area.png"]),gameScene.addChild(dungeon),(explorer=new Sprite(id["explorer.png"])).x=68,explorer.y=gameScene.height/2-explorer.height/2,explorer.vx=0,explorer.vy=0;let e=socialSpeed,t=3;immunes=[];let n=naturalImmunity;for(let i=0;i<n;i++){immune=new Sprite(id["immune.png"]);let n=randomInt(0,app.stage.width-immune.width),i=randomInt(0,app.stage.height-immune.height);immune.x=n,immune.y=i,immune.vy=e*randomInt(-3,3),immune.vx=e*randomInt(-3,3),t*=-1,immunes.push(immune),gameScene.addChild(immune)}let i=riskpop;infecteds=[];for(let n=0;n<i;n++){infected=new Sprite(id["infected.png"]);let n=randomInt(0,app.stage.width-infected.width),i=randomInt(0,app.stage.height-infected.height);infected.x=n,infected.y=i,infected.vy=e*randomInt(-3,3),infected.vx=e*randomInt(-3,3),infected.infection=infectionLength,t*=-1,infecteds.push(infected),gameScene.addChild(infected)}let a=populations;healthys=[];for(let n=0;n<a;n++){let n=new Sprite(id["healthy.png"]),i=randomInt(0,700-n.width),a=randomInt(0,700-n.height);n.x=i,n.y=a,n.vy=e*randomInt(-3,3),n.vx=e*randomInt(-3,3),t*=-1,healthys.push(n),gameScene.addChild(n)}gameOverScene=new Container,app.stage.addChild(gameOverScene),gameOverScene.visible=!1;new TextStyle({fontFamily:"Futura",fontSize:64,fill:"white"});state=play,app.ticker.add(e=>gameLoop(e))}function gameLoop(e){state(e)}function play(e){explorer.x+=explorer.vx,explorer.y+=explorer.vy,contain(explorer,{x:28,y:10,width:700,height:700});healthys.forEach(function(e){e.y+=e.vy,e.x+=e.vx;let t=contain(e,{x:28,y:10,width:700,height:700});"top"!==t&&"bottom"!==t||(e.vy*=-1),"left"!==t&&"right"!==t||(e.vx*=-1),healthys.forEach(function(t){hitTestRectangle(e,t,Radius)&&bump&&(e.vx*=-1,e.vy*=-1,t.vx*=-1,t.vy*=-1)})}),infecteds.forEach(function(e,t,n){e.y+=e.vy,e.x+=e.vx;let i=contain(e,{x:28,y:10,width:700,height:700});if("top"!==i&&"bottom"!==i||(e.vy*=-1),"left"!==i&&"right"!==i||(e.vx*=-1),healthys.forEach(function(t,n,i){if(hitTestRectangle(e,t,Radius)){let a;transmission()&&((a=new Sprite(id["infected.png"])).x=t.x,a.y=t.y,a.vy=t.vy,a.vx=t.vx,a.infection=infectionLength,infecteds.push(a),i.splice(n,1),gameScene.addChild(a),gameScene.removeChild(t)),bump&&(e.vx*=-1,e.vy*=-1,t.vx*=-1,t.vy*=-1),healtys=i}}),e.infection--,!e.infection){let i;(i=new Sprite(id["immune.png"])).x=e.x,i.y=e.y,i.vy=e.vy,i.vx=e.vx,i.infection=30,immunes.push(i),n.splice(t,1),gameScene.addChild(i),gameScene.removeChild(e)}infecteds=n}),immunes.forEach(function(e){e.y+=e.vy,e.x+=e.vx;let t=contain(e,{x:28,y:10,width:700,height:700});"top"!==t&&"bottom"!==t||(e.vy*=-1),"left"!==t&&"right"!==t||(e.vx*=-1),immunes.forEach(function(t){hitTestRectangle(e,t,Radius)&&bump&&(e.vx*=-1,e.vy*=-1,t.vx*=-1,t.vy*=-1)})}),explorer.alpha=1,hitTestRectangle(explorer,infected,Radius)&&(infected.x=explorer.x+8,infected.y=explorer.y+8),0==infecteds.length&&(state=end)}function end(){}function transmission(){return randomInt(0,100/transmissibility)<1}function contain(e,t){let n=void 0;return e.x<t.x&&(e.x=t.x,n="left"),e.y<t.y&&(e.y=t.y,n="top"),e.x+e.width>t.width&&(e.x=t.width-e.width,n="right"),e.y+e.height>t.height&&(e.y=t.height-e.height,n="bottom"),n}function hitTestRectangle(e,t,n){let i,a,r,d,o;return i=!1,e.centerX=e.x+e.width/2,e.centerY=e.y+e.height/2,t.centerX=t.x+t.width/2,t.centerY=t.y+t.height/2,e.halfWidth=e.width/2,e.halfHeight=e.height/2,t.halfWidth=t.width/2,t.halfHeight=t.height/2,d=e.centerX-t.centerX,o=e.centerY-t.centerY,a=n,r=n,i=Math.abs(d)<a&&Math.abs(o)<r}function randomInt(e,t){let n=Math.random();return 0===n&&(n=1),Math.floor(n*(t-e+1))+e}function keyboard(e){var t={};return t.code=e,t.isDown=!1,t.isUp=!0,t.press=void 0,t.release=void 0,t.downHandler=function(e){e.keyCode===t.code&&(t.isUp&&t.press&&t.press(),t.isDown=!0,t.isUp=!1),e.preventDefault()},t.upHandler=function(e){e.keyCode===t.code&&(t.isDown&&t.release&&t.release(),t.isDown=!1,t.isUp=!0),e.preventDefault()},window.addEventListener("keydown",t.downHandler.bind(t),!1),window.addEventListener("keyup",t.upHandler.bind(t),!1),t}renderScene();