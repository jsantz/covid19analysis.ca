var Application=PIXI.Application,Container=PIXI.Container,loader=PIXI.loader,resources=PIXI.loader.resources,Graphics=PIXI.Graphics,TextureCache=PIXI.utils.TextureCache,Sprite=PIXI.Sprite,TextStyle=PIXI.TextStyle,Radius=10,populations=200,naturalImmunity=1,numMortal=0;riskpop=1;bump=!0;transmissibility=70;socialSpeed=1;infectionLength=300;sample=30;timeline=0;mortalityRate=3;healthyset=[];immuneset=[];infectedset=[];mortalset=[];healthyperc=[];immuneperc=[];infectedperc=[];mortalperc=[];
xvalsSim=[];quarantineLevel=0;var state,mortal,infected,healthy,chimes,exit,player,dungeon,immune,healthBar,message,gameScene,gameOverScene,enemies,id,app=new Application({width:810,height:810,antialiasing:!0,transparent:!1,resolution:1});function renderScene(){document.body.appendChild(app.view);loader.add("images/pandemic.json");loader.load(setup)}
function setup(){gameScene=new Container;app.stage.addChild(gameScene);id=resources["images/pandemic.json"].textures;dungeon=new Sprite(id["area.png"]);gameScene.addChild(dungeon);explorer=new Sprite(id["explorer.png"]);explorer.x=68;explorer.y=gameScene.height/2-explorer.height/2;explorer.vx=0;explorer.vy=0;var b=socialSpeed;mortals=[];for(var a=numMortal,c=0;c<a;c++)mortal=new Sprite(id["explorer.png"]),mortal.x=68,mortal.y=gameScene.height/2-mortal.height/2,mortal.vx=0,mortal.vy=0,gameScene.addChild(mortal);
    immunes=[];a=naturalImmunity;for(c=0;c<a;c++){immune=new Sprite(id["immune.png"]);var d=randomInt(0,app.stage.width-immune.width),f=randomInt(0,app.stage.height-immune.height);immune.x=d;immune.y=f;immune.vy=b*randomInt(-3,3);immune.vx=b*randomInt(-3,3);immunes.push(immune);gameScene.addChild(immune)}a=riskpop;infecteds=[];for(c=0;c<a;c++)infected=new Sprite(id["infected.png"]),d=randomInt(0,app.stage.width-infected.width),f=randomInt(0,app.stage.height-infected.height),infected.x=d,infected.y=f,
        infected.vy=b*randomInt(-3,3),infected.vx=b*randomInt(-3,3),infected.infection=infectionLength,infecteds.push(infected),gameScene.addChild(infected);a=populations;healthys=[];for(c=0;c<a;c++){d=new Sprite(id["healthy.png"]);f=randomInt(0,800-d.width);var l=randomInt(0,800-d.height);d.x=f;d.y=l;isQuarantined()?(d.vy=0,d.vx=0):(d.vy=b*randomInt(-3,3),d.vx=b*randomInt(-3,3));healthys.push(d);gameScene.addChild(d)}gameOverScene=new Container;app.stage.addChild(gameOverScene);gameOverScene.visible=!1;
    new TextStyle({fontFamily:"Futura",fontSize:64,fill:"white"});var g=keyboard(37),h=keyboard(38),e=keyboard(39),k=keyboard(40);g.press=function(){mortal.vx=-5;mortal.vy=0};g.release=function(){e.isDown||0!==mortal.vy||(mortal.vx=0)};h.press=function(){mortal.vy=-5;mortal.vx=0};h.release=function(){k.isDown||0!==mortal.vx||(mortal.vy=0)};e.press=function(){mortal.vx=5;mortal.vy=0};e.release=function(){g.isDown||0!==mortal.vy||(mortal.vx=0)};k.press=function(){mortal.vy=5;mortal.vx=0};k.release=function(){h.isDown||
    0!==mortal.vx||(mortal.vy=0)};state=play;app.ticker.add(function(a){return gameLoop(a)})}function gameLoop(b){state(b)}
function play(b){sample--;healthys.forEach(function(a){a.y+=a.vy;a.x+=a.vx;var b=contain(a,{x:28,y:10,width:800,height:800});if("top"===b||"bottom"===b)a.vy*=-1;if("left"===b||"right"===b)a.vx*=-1;healthys.forEach(function(b){hitTestRectangle(a,b,Radius)&&bump&&(a.vx*=-1,a.vy*=-1,b.vx*=-1,b.vy*=-1)})});infecteds.forEach(function(a,b,d){a.y+=a.vy;a.x+=a.vx;var c=contain(a,{x:28,y:10,width:800,height:800});if("top"===c||"bottom"===c)a.vy*=-1;if("left"===c||"right"===c)a.vx*=-1;infecteds.forEach(function(b){hitTestRectangle(a,
    b,Radius)&&bump&&(a.vx*=-1,a.vy*=-1,b.vx*=-1,b.vy*=-1)});healthys.forEach(function(b,c,d){if(hitTestRectangle(a,b,Radius)){if(transmission()){var e=new Sprite(id["infected.png"]);e.x=b.x;e.y=b.y;e.vy=b.vy;e.vx=b.vx;e.infection=infectionLength;infecteds.push(e);d.splice(c,1);gameScene.addChild(e);gameScene.removeChild(b)}bump&&(a.vx*=-1,a.vy*=-1,b.vx*=-1,b.vy*=-1);healtys=d}});a.infection--;a.infection||(mortality()?(c=new Sprite(id["explorer.png"]),c.x=a.x,c.y=a.y,c.vx=0,c.vy=0,mortals.push(c),d.splice(b,
    1),gameScene.addChild(c)):(c=new Sprite(id["immune.png"]),c.x=a.x,c.y=a.y,c.vy=a.vy,c.vx=a.vx,c.infection=30,immunes.push(c),d.splice(b,1),gameScene.addChild(c)),gameScene.removeChild(a));infecteds=d});immunes.forEach(function(a){a.y+=a.vy;a.x+=a.vx;var b=contain(a,{x:28,y:10,width:800,height:800});if("top"===b||"bottom"===b)a.vy*=-1;if("left"===b||"right"===b)a.vx*=-1;immunes.forEach(function(b){hitTestRectangle(a,b,Radius)&&bump&&(a.vx*=-1,a.vy*=-1,b.vx*=-1,b.vy*=-1)});healthys.forEach(function(b){hitTestRectangle(a,
    b,Radius)&&bump&&(a.vx*=-1,a.vy*=-1,b.vx*=-1,b.vy*=-1)});infecteds.forEach(function(b){hitTestRectangle(a,b,Radius)&&bump&&(a.vx*=-1,a.vy*=-1,b.vx*=-1,b.vy*=-1)})});explorer.alpha=1;0==infecteds.length&&(state=end);sample||(sample=30,healthyset[timeline]={t:timeline,y:healthys.length},infectedset[timeline]={t:timeline,y:infecteds.length},immuneset[timeline]={t:timeline,y:immunes.length},mortalset[timeline]={t:timeline,y:mortals.length},$("#phealthy").text(healthys.length),$("#pinfected").text(infecteds.length),
    $("#pimmune").text(immunes.length),$("#pmortal").text(mortals.length),xvalsSim[timeline]=timeline,0<timeline&&(healthyperc[timeline]={t:timeline,y:perc(healthyset[timeline].y,healthyset[timeline-1].y)},immuneperc[timeline]={t:timeline,y:perc(immuneset[timeline].y,immuneset[timeline-1].y)},infectedperc[timeline]={t:timeline,y:perc(infectedset[timeline].y,infectedset[timeline-1].y)},mortalperc[timeline]={t:timeline,y:perc(mortalset[timeline].y,mortalset[timeline-1].y)},window.myLineP.update()),window.myLine.update(),
    timeline++)}function perc(b,a){return 100*(b-a)}function end(){}function transmission(){return Math.random()<transmissibility/100}function mortality(){return Math.random()<mortalityRate/100}function contain(b,a){var c=void 0;b.x<a.x&&(b.x=a.x,c="left");b.y<a.y&&(b.y=a.y,c="top");b.x+b.width>a.width&&(b.x=a.width-b.width,c="right");b.y+b.height>a.height&&(b.y=a.height-b.height,c="bottom");return c}
function hitTestRectangle(b,a,c){b.centerX=b.x+b.width/2;b.centerY=b.y+b.height/2;a.centerX=a.x+a.width/2;a.centerY=a.y+a.height/2;b.halfWidth=b.width/2;b.halfHeight=b.height/2;a.halfWidth=a.width/2;a.halfHeight=a.height/2;dist=Math.sqrt(Math.pow(b.centerX-a.centerX,2)+Math.pow(b.centerY-a.centerY,2));return dist<c}function randomInt(b,a){var c=Math.random();0===c&&(c=1);return Math.floor(c*(a-b+1))+b}
function keyboard(b){var a={};a.code=b;a.isDown=!1;a.isUp=!0;a.press=void 0;a.release=void 0;a.downHandler=function(b){b.keyCode===a.code&&(a.isUp&&a.press&&a.press(),a.isDown=!0,a.isUp=!1);b.preventDefault()};a.upHandler=function(b){b.keyCode===a.code&&(a.isDown&&a.release&&a.release(),a.isDown=!1,a.isUp=!0);b.preventDefault()};window.addEventListener("keydown",a.downHandler.bind(a),!1);window.addEventListener("keyup",a.upHandler.bind(a),!1);return a}renderScene();
var configsim={type:"line",data:{labels:xvalsSim,datasets:[{label:"Immune",borderColor:"#a4c15b",backgroundColor:"#c6d899",data:immuneset},{label:"Infected",borderColor:"#FF0000",backgroundColor:"#FFaf30",data:infectedset},{label:"Susceptible",borderColor:"#4383cc",backgroundColor:"#8ab2df",data:healthyset},{label:"Victim",borderColor:"#505050",backgroundColor:"#f0f0f0",data:mortalset}]},options:{responsive:!0,title:{display:!0,text:"Population Changes"},tooltips:{mode:"index"},hover:{mode:"index"},
        scales:{xAxes:[{distribution:"series",offset:!0,labelString:"Epoch",ticks:{major:{enabled:!0,fontStyle:"bold"},source:"data",autoSkip:!0,autoSkipPadding:75,maxRotation:0,sampleSize:100}}],yAxes:[{stacked:!1,scaleLabel:{display:!0,labelString:"Population"}}]}}},configperc={type:"line",data:{labels:xvalsSim,datasets:[{label:"Immune",borderColor:"#a4c15b",backgroundColor:"#c6d899",data:immuneperc},{label:"Infected",borderColor:"#FF0000",backgroundColor:"#FFaf30",data:infectedperc},{label:"Susceptible",
            borderColor:"#4383cc",backgroundColor:"#8ab2df",data:healthyperc},{label:"Victim",borderColor:"#505050",backgroundColor:"#f0f0f0",data:mortalperc}]},options:{responsive:!0,title:{display:!0,text:"Percent Population Changes"},tooltips:{mode:"index"},hover:{mode:"index"},scales:{xAxes:[{distribution:"series",offset:!0,labelString:"Epoch",ticks:{major:{enabled:!0,fontStyle:"bold"},source:"data",autoSkip:!0,autoSkipPadding:75,maxRotation:0,sampleSize:100}}],yAxes:[{stacked:!1,scaleLabel:{display:!0,labelString:"Population"}}]}}};
function isQuarantined(){return Math.random()<quarantineLevel/100}var ctxx=document.getElementById("canvassim").getContext("2d");window.myLine=new Chart(ctxx,configsim);var ctxp=document.getElementById("canvasperc").getContext("2d");window.myLineP=new Chart(ctxp,configperc);
$("#runsimulation").click(function(){$("#graphholder").html("<h1>Resetting...</h1>");window.myLine.destroy();window.myLineP.destroy();bump=$("#isBounce").is(":checked");populations=$("#slider-range-min").slider("value");transmissibility=$("#transmissibility").slider("value");socialSpeed=$("#movementspd").slider("value")/100;quarantineLevel=$("#shelter").slider("value");Radius=$("#radius").slider("value");infectionLength=30*$("#infectionTime").slider("value");mortalityRate=$("#mortality").slider("value");
    $("#graphholder").html('<canvas id="canvasperc"></canvas><canvas id="canvassim"></canvas>');app.destroy(!0);app=null;loader.reset();app=new Application({width:810,height:810,antialiasing:!0,transparent:!1,resolution:1});healthyset=[];immuneset=[];infectedset=[];mortalset=[];healthyperc=[];immuneperc=[];infectedperc=[];mortalperc=[];xvalsSim=[];timeline=0;var b={type:"line",data:{labels:xvalsSim,datasets:[{label:"Victim",borderColor:"#101010",backgroundColor:"#f0f0f0",data:mortalset},{label:"Immune",
                borderColor:"#a4c15b",backgroundColor:"#c6d899",data:immuneset},{label:"Infected",borderColor:"#FF0000",backgroundColor:"#FFaf30",data:infectedset},{label:"Healthy",borderColor:"#4383cc",backgroundColor:"#8ab2df",data:healthyset}]},options:{responsive:!0,title:{display:!0,text:"Population Changes"},tooltips:{mode:"index"},hover:{mode:"index"},scales:{xAxes:[{distribution:"series",offset:!0,labelString:"Epoch",ticks:{major:{enabled:!0,fontStyle:"bold"},source:"data",autoSkip:!0,autoSkipPadding:75,
                        maxRotation:0,sampleSize:100}}],yAxes:[{stacked:!1,scaleLabel:{display:!0,labelString:"Population"}}]}}},a={type:"line",data:{labels:xvalsSim,datasets:[{label:"Immune",borderColor:"#a4c15b",backgroundColor:"#c6d899",data:immuneperc},{label:"Infected",borderColor:"#FF0000",backgroundColor:"#FFaf30",data:infectedperc},{label:"Susceptible",borderColor:"#4383cc",backgroundColor:"#8ab2df",data:healthyperc},{label:"Victim",borderColor:"#505050",backgroundColor:"#f0f0f0",data:mortalperc}]},options:{responsive:!0,
            title:{display:!0,text:"Population Changes"},tooltips:{mode:"index"},hover:{mode:"index"},scales:{xAxes:[{distribution:"series",offset:!0,labelString:"Epoch",ticks:{major:{enabled:!0,fontStyle:"bold"},source:"data",autoSkip:!0,autoSkipPadding:75,maxRotation:0,sampleSize:100}}],yAxes:[{stacked:!1,scaleLabel:{display:!0,labelString:"Population"}}]}}},c=document.getElementById("canvassim").getContext("2d");window.myLine=new Chart(c,b);b=document.getElementById("canvasperc").getContext("2d");window.myLineP=
        new Chart(b,a);renderScene()});$(function(){var b=$("#custom-handle");$("#slider-range-min").slider({range:"min",value:200,min:50,max:800,create:function(){b.text($(this).slider("value"))},slide:function(a,c){$("#amount").val(c.value);b.text(c.value)}});$("#amount").val(+$("#slider-range-min").slider("value"))});
$(function(){var b=$("#transmissibility-handle");$("#transmissibility").slider({range:"min",value:70,min:1,max:100,create:function(){b.text($(this).slider("value"))},slide:function(a,c){$("#transmissibility-label").val("% "+c.value);b.text("%"+c.value)}});$("#transmissibility-label").val("% "+$("#transmissibility").slider("value"))});
$(function(){var b=$("#movementspd-handle");$("#movementspd").slider({range:"min",value:100,min:1,max:200,create:function(){b.text($(this).slider("value"))},slide:function(a,c){$("#movementspd-label").val("% "+c.value);b.text("%"+c.value)}});$("#movementspd-label").val("% "+$("#movementspd").slider("value"))});
$(function(){var b=$("#shelter-handle");$("#shelter").slider({range:"min",value:0,min:0,max:100,create:function(){b.text($(this).slider("value"))},slide:function(a,c){$("#shelter-label").val("% "+c.value);b.text("%"+c.value)}});$("#shelter-label").val("% "+$("#shelter").slider("value"))});
$(function(){var b=$("#radius-handle");$("#radius").slider({range:"min",value:10,min:1,max:20,create:function(){b.text($(this).slider("value"))},slide:function(a,c){$("#radius-label").val(c.value);b.text(c.value)}});$("#radius-label").val($("#radius").slider("value"))});
$(function(){var b=$("#infectionTime-handle");$("#infectionTime").slider({range:"min",value:10,min:1,max:30,create:function(){b.text($(this).slider("value"))},slide:function(a,c){$("#infectionTime-label").val(c.value);b.text(c.value)}});$("#infectionTime-label").val($("#infectionTime").slider("value"))});
$(function(){var b=$("#mortality-handle");$("#mortality").slider({range:"min",value:3,min:0,max:100,create:function(){b.text($(this).slider("value"))},slide:function(a,c){$("#mortality-label").val(c.value);b.text(c.value)}});$("#mortality-label").val($("#mortality").slider("value"))});