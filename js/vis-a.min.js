var Application=PIXI.Application,Container=PIXI.Container,loader=PIXI.loader,resources=PIXI.loader.resources,Graphics=PIXI.Graphics,TextureCache=PIXI.utils.TextureCache,Sprite=PIXI.Sprite,TextStyle=PIXI.TextStyle,Radius=10,populations=200,naturalImmunity=1,riskpop=1,bump=!1,transmissibility=100,socialSpeed=1,infectionLength=300,sample=30,timeline=0,healthyset=[],immuneset=[],infectedset=[],xvalsSim=[],quarantineLevel=0,state,explorer,infected,healthy,chimes,exit,player,dungeon,immune,healthBar,message,
    gameScene,gameOverScene,enemies,id,app=new Application({width:710,height:710,antialiasing:!0,transparent:!1,resolution:1});function renderScene(){document.body.appendChild(app.view);loader.add("images/pandemic.json");loader.load(setup)}
function setup(){gameScene=new Container;app.stage.addChild(gameScene);id=resources["images/pandemic.json"].textures;dungeon=new Sprite(id["area.png"]);gameScene.addChild(dungeon);explorer=new Sprite(id["explorer.png"]);explorer.x=68;explorer.y=gameScene.height/2-explorer.height/2;explorer.vx=0;explorer.vy=0;var b=socialSpeed;immunes=[];for(var a=naturalImmunity,c=0;c<a;c++){immune=new Sprite(id["immune.png"]);var d=randomInt(0,app.stage.width-immune.width),f=randomInt(0,app.stage.height-immune.height);
    immune.x=d;immune.y=f;immune.vy=b*randomInt(-3,3);immune.vx=b*randomInt(-3,3);immunes.push(immune);gameScene.addChild(immune)}a=riskpop;infecteds=[];for(c=0;c<a;c++)infected=new Sprite(id["infected.png"]),d=randomInt(0,app.stage.width-infected.width),f=randomInt(0,app.stage.height-infected.height),infected.x=d,infected.y=f,infected.vy=b*randomInt(-3,3),infected.vx=b*randomInt(-3,3),infected.infection=infectionLength,infecteds.push(infected),gameScene.addChild(infected);a=populations;healthys=[];for(c=
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                0;c<a;c++){d=new Sprite(id["healthy.png"]);f=randomInt(0,700-d.width);var l=randomInt(0,700-d.height);d.x=f;d.y=l;isQuarantined()?(d.vy=0,d.vx=0):(d.vy=b*randomInt(-3,3),d.vx=b*randomInt(-3,3));healthys.push(d);gameScene.addChild(d)}gameOverScene=new Container;app.stage.addChild(gameOverScene);gameOverScene.visible=!1;new TextStyle({fontFamily:"Futura",fontSize:64,fill:"white"});var g=keyboard(37),h=keyboard(38),e=keyboard(39),k=keyboard(40);g.press=function(){explorer.vx=-5;explorer.vy=0};g.release=
    function(){e.isDown||0!==explorer.vy||(explorer.vx=0)};h.press=function(){explorer.vy=-5;explorer.vx=0};h.release=function(){k.isDown||0!==explorer.vx||(explorer.vy=0)};e.press=function(){explorer.vx=5;explorer.vy=0};e.release=function(){g.isDown||0!==explorer.vy||(explorer.vx=0)};k.press=function(){explorer.vy=5;explorer.vx=0};k.release=function(){h.isDown||0!==explorer.vx||(explorer.vy=0)};state=play;app.ticker.add(function(a){return gameLoop(a)})}function gameLoop(b){state(b)}
function play(b){sample--;explorer.x+=explorer.vx;explorer.y+=explorer.vy;contain(explorer,{x:28,y:10,width:700,height:700});healthys.forEach(function(a){a.y+=a.vy;a.x+=a.vx;var b=contain(a,{x:28,y:10,width:700,height:700});if("top"===b||"bottom"===b)a.vy*=-1;if("left"===b||"right"===b)a.vx*=-1;healthys.forEach(function(b){hitTestRectangle(a,b,Radius)&&bump&&(a.vx*=-1,a.vy*=-1,b.vx*=-1,b.vy*=-1)})});infecteds.forEach(function(a,b,d){a.y+=a.vy;a.x+=a.vx;var c=contain(a,{x:28,y:10,width:700,height:700});
    if("top"===c||"bottom"===c)a.vy*=-1;if("left"===c||"right"===c)a.vx*=-1;infecteds.forEach(function(b){hitTestRectangle(a,b,Radius)&&bump&&(a.vx*=-1,a.vy*=-1,b.vx*=-1,b.vy*=-1)});healthys.forEach(function(b,c,d){if(hitTestRectangle(a,b,Radius)){if(transmission()){var e=new Sprite(id["infected.png"]);e.x=b.x;e.y=b.y;e.vy=b.vy;e.vx=b.vx;e.infection=infectionLength;infecteds.push(e);d.splice(c,1);gameScene.addChild(e);gameScene.removeChild(b)}bump&&(a.vx*=-1,a.vy*=-1,b.vx*=-1,b.vy*=-1);healtys=d}});a.infection--;
    a.infection||(c=new Sprite(id["immune.png"]),c.x=a.x,c.y=a.y,c.vy=a.vy,c.vx=a.vx,c.infection=30,immunes.push(c),d.splice(b,1),gameScene.addChild(c),gameScene.removeChild(a));infecteds=d});immunes.forEach(function(a){a.y+=a.vy;a.x+=a.vx;var b=contain(a,{x:28,y:10,width:700,height:700});if("top"===b||"bottom"===b)a.vy*=-1;if("left"===b||"right"===b)a.vx*=-1;immunes.forEach(function(b){hitTestRectangle(a,b,Radius)&&bump&&(a.vx*=-1,a.vy*=-1,b.vx*=-1,b.vy*=-1)});healthys.forEach(function(b){hitTestRectangle(a,
    b,Radius)&&bump&&(a.vx*=-1,a.vy*=-1,b.vx*=-1,b.vy*=-1)});infecteds.forEach(function(b){hitTestRectangle(a,b,Radius)&&bump&&(a.vx*=-1,a.vy*=-1,b.vx*=-1,b.vy*=-1)})});explorer.alpha=1;hitTestRectangle(explorer,infected,Radius)&&(infected.x=explorer.x+8,infected.y=explorer.y+8);0==infecteds.length&&(state=end);sample||(sample=30,healthyset[timeline]={t:timeline,y:healthys.length},infectedset[timeline]={t:timeline,y:infecteds.length},immuneset[timeline]={t:timeline,y:immunes.length},xvalsSim[timeline]=
    timeline,window.myLine.update(),timeline++)}function end(){}function transmission(){return Math.random()<transmissibility/100}function contain(b,a){var c=void 0;b.x<a.x&&(b.x=a.x,c="left");b.y<a.y&&(b.y=a.y,c="top");b.x+b.width>a.width&&(b.x=a.width-b.width,c="right");b.y+b.height>a.height&&(b.y=a.height-b.height,c="bottom");return c}
function hitTestRectangle(b,a,c){b.centerX=b.x+b.width/2;b.centerY=b.y+b.height/2;a.centerX=a.x+a.width/2;a.centerY=a.y+a.height/2;b.halfWidth=b.width/2;b.halfHeight=b.height/2;a.halfWidth=a.width/2;a.halfHeight=a.height/2;var d=b.centerX-a.centerX;b=b.centerY-a.centerY;return Math.abs(d)<c?Math.abs(b)<c?!0:!1:!1}function randomInt(b,a){var c=Math.random();0===c&&(c=1);return Math.floor(c*(a-b+1))+b}
function keyboard(b){var a={};a.code=b;a.isDown=!1;a.isUp=!0;a.press=void 0;a.release=void 0;a.downHandler=function(b){b.keyCode===a.code&&(a.isUp&&a.press&&a.press(),a.isDown=!0,a.isUp=!1);b.preventDefault()};a.upHandler=function(b){b.keyCode===a.code&&(a.isDown&&a.release&&a.release(),a.isDown=!1,a.isUp=!0);b.preventDefault()};window.addEventListener("keydown",a.downHandler.bind(a),!1);window.addEventListener("keyup",a.upHandler.bind(a),!1);return a}renderScene();
var configsim={type:"line",data:{labels:xvalsSim,datasets:[{label:"Immune",borderColor:"#a4c15b",backgroundColor:"#c6d899",data:immuneset},{label:"Infected",borderColor:"#FF0000",backgroundColor:"#FFaf30",data:infectedset},{label:"Healthy",borderColor:"#4383cc",backgroundColor:"#8ab2df",data:healthyset}]},options:{responsive:!0,title:{display:!0,text:"Population Changes"},tooltips:{mode:"index"},hover:{mode:"index"},scales:{xAxes:[{distribution:"series",offset:!0,labelString:"Epoch",ticks:{major:{enabled:!0,
                        fontStyle:"bold"},source:"data",autoSkip:!0,autoSkipPadding:75,maxRotation:0,sampleSize:100}}],yAxes:[{stacked:!1,scaleLabel:{display:!0,labelString:"Population"}}]}}};function isQuarantined(){return Math.random()<quarantineLevel/100}var ctxx=document.getElementById("canvassim").getContext("2d");window.myLine=new Chart(ctxx,configsim);
$("#runsimulation").click(function(){bump=$("#isBounce").is(":checked");populations=$("#slider-range-min").slider("value");transmissibility=$("#transmissibility").slider("value");socialSpeed=$("#movementspd").slider("value")/100;quarantineLevel=$("#shelter").slider("value");Radius=$("#radius").slider("value");infectionLength=30*$("#infectionTime").slider("value");app.destroy(!0);app=null;loader.reset();app=new Application({width:710,height:710,antialiasing:!0,transparent:!1,resolution:1});healthyset=
    [];immuneset=[];infectedset=[];xvalsSim=[];timeline=0;var b={type:"line",data:{labels:xvalsSim,datasets:[{label:"Healthy",borderColor:"#4383cc",backgroundColor:"#8ab2df",data:healthyset},{label:"Infected",borderColor:"#FF0000",backgroundColor:"#FFaf30",data:infectedset},{label:"Immune",borderColor:"#a4c15b",backgroundColor:"#c6d899",data:immuneset}]},options:{responsive:!0,title:{display:!0,text:"Population Changes"},tooltips:{mode:"index"},hover:{mode:"index"},scales:{xAxes:[{distribution:"series",
                offset:!0,labelString:"Epoch",ticks:{major:{enabled:!0,fontStyle:"bold"},source:"data",autoSkip:!0,autoSkipPadding:75,maxRotation:0,sampleSize:100}}],yAxes:[{stacked:!1,scaleLabel:{display:!0,labelString:"Population"}}]}}},a=document.getElementById("canvassim").getContext("2d");window.myLine=new Chart(a,b);renderScene()});
$(function(){var b=$("#custom-handle");$("#slider-range-min").slider({range:"min",value:200,min:50,max:400,create:function(){b.text($(this).slider("value"))},slide:function(a,c){$("#amount").val(c.value);b.text(c.value)}});$("#amount").val(+$("#slider-range-min").slider("value"))});
$(function(){var b=$("#transmissibility-handle");$("#transmissibility").slider({range:"min",value:20,min:1,max:100,create:function(){b.text($(this).slider("value"))},slide:function(a,c){$("#transmissibility-label").val("% "+c.value);b.text("%"+c.value)}});$("#transmissibility-label").val("% "+$("#transmissibility").slider("value"))});
$(function(){var b=$("#movementspd-handle");$("#movementspd").slider({range:"min",value:100,min:1,max:200,create:function(){b.text($(this).slider("value"))},slide:function(a,c){$("#movementspd-label").val("% "+c.value);b.text("%"+c.value)}});$("#movementspd-label").val("% "+$("#movementspd").slider("value"))});
$(function(){var b=$("#shelter-handle");$("#shelter").slider({range:"min",value:0,min:0,max:100,create:function(){b.text($(this).slider("value"))},slide:function(a,c){$("#shelter-label").val("% "+c.value);b.text("%"+c.value)}});$("#shelter-label").val("% "+$("#shelter").slider("value"))});
$(function(){var b=$("#radius-handle");$("#radius").slider({range:"min",value:10,min:1,max:20,create:function(){b.text($(this).slider("value"))},slide:function(a,c){$("#radius-label").val(c.value);b.text(c.value)}});$("#radius-label").val($("#radius").slider("value"))});
$(function(){var b=$("#infectionTime-handle");$("#infectionTime").slider({range:"min",value:10,min:1,max:30,create:function(){b.text($(this).slider("value"))},slide:function(a,c){$("#infectionTime-label").val(c.value);b.text(c.value)}});$("#infectionTime-label").val($("#infectionTime").slider("value"))});