var Application=PIXI.Application,Container=PIXI.Container,loader=PIXI.loader,resources=PIXI.loader.resources,Graphics=PIXI.Graphics,TextureCache=PIXI.utils.TextureCache,Sprite=PIXI.Sprite,TextStyle=PIXI.TextStyle,Radius=10,populations=200,naturalImmunity=1,numMortal=0;riskpop=1;bump=!0;transmissibility=70;socialSpeed=1;infectionLength=300;sample=30;timeline=0;mortalityRate=3;hospitalcapacity=10;healthyset=[];immuneset=[];infectedset=[];mortalset=[];healthyperc=[];immuneperc=[];infectedperc=[];
mortalperc=[];absperc=[];xvalsSim=[];quarantineLevel=0;var state,mortal,infected,healthy,chimes,exit,player,dungeon,immune,healthBar,message,gameScene,gameOverScene,enemies,id,app=new Application({width:810,height:810,antialiasing:!0,transparent:!1,resolution:1});
function renderScene(){switch(md5(window.location.href)){case "c09ce2adb4108aa83617e607547adee8":document.body.appendChild(app.view);loader.add("images/pandemic.json");loader.load(setup);break;case "9a20de86faffaa7d13932bfbd814eb98":document.body.appendChild(app.view);loader.add("images/pandemic.json");loader.load(setup);break;case "46c5c5af0c9fbdfedfc096019dfda1bf":document.body.appendChild(app.view),loader.add("images/pandemic.json"),loader.load(setup)}}
function setup(){gameScene=new Container;app.stage.addChild(gameScene);id=resources["images/pandemic.json"].textures;dungeon=new Sprite(id["area.png"]);gameScene.addChild(dungeon);explorer=new Sprite(id["explorer.png"]);explorer.x=68;explorer.y=gameScene.height/2-explorer.height/2;explorer.vx=0;explorer.vy=0;var e=socialSpeed;mortals=[];for(var a=numMortal,b=0;b<a;b++)mortal=new Sprite(id["explorer.png"]),mortal.x=68,mortal.y=gameScene.height/2-mortal.height/2,mortal.vx=0,mortal.vy=0,gameScene.addChild(mortal);
    immunes=[];a=naturalImmunity;for(b=0;b<a;b++){immune=new Sprite(id["immune.png"]);var c=randomInt(0,app.stage.width-immune.width),d=randomInt(0,app.stage.height-immune.height);immune.x=c;immune.y=d;immune.vy=e*randomInt(-3,3);immune.vx=e*randomInt(-3,3);immunes.push(immune);gameScene.addChild(immune)}a=riskpop;infecteds=[];for(b=0;b<a;b++)infected=new Sprite(id["infected.png"]),c=randomInt(0,app.stage.width-infected.width),d=randomInt(0,app.stage.height-infected.height),infected.x=c,infected.y=d,
        infected.vy=e*randomInt(-3,3),infected.vx=e*randomInt(-3,3),infected.infection=infectionLength,infecteds.push(infected),gameScene.addChild(infected);a=populations;healthys=[];for(b=0;b<a;b++){c=new Sprite(id["healthy.png"]);d=randomInt(0,800-c.width);var f=randomInt(0,800-c.height);c.x=d;c.y=f;isQuarantined()?(c.vy=0,c.vx=0):(c.vy=e*randomInt(-3,3),c.vx=e*randomInt(-3,3));healthys.push(c);gameScene.addChild(c)}gameOverScene=new Container;app.stage.addChild(gameOverScene);gameOverScene.visible=!1;
    new TextStyle({fontFamily:"Futura",fontSize:64,fill:"white"});var g=keyboard(37),h=keyboard(38),k=keyboard(39),l=keyboard(40);g.press=function(){mortal.vx=-5;mortal.vy=0};g.release=function(){k.isDown||0!==mortal.vy||(mortal.vx=0)};h.press=function(){mortal.vy=-5;mortal.vx=0};h.release=function(){l.isDown||0!==mortal.vx||(mortal.vy=0)};k.press=function(){mortal.vx=5;mortal.vy=0};k.release=function(){g.isDown||0!==mortal.vy||(mortal.vx=0)};l.press=function(){mortal.vy=5;mortal.vx=0};l.release=function(){h.isDown||
    0!==mortal.vx||(mortal.vy=0)};state=play;app.ticker.add(function(a){return gameLoop(a)})}function gameLoop(e){state(e)}
function play(e){sample--;healthys.forEach(function(a){a.y+=a.vy;a.x+=a.vx;var b=contain(a,{x:28,y:10,width:800,height:800});if("top"===b||"bottom"===b)a.vy*=-1;if("left"===b||"right"===b)a.vx*=-1;healthys.forEach(function(b){hitTestRectangle(a,b,Radius)&&bump&&(a.vx*=-1,a.vy*=-1,b.vx*=-1,b.vy*=-1)})});infecteds.forEach(function(a,b,c){a.y+=a.vy;a.x+=a.vx;var d=contain(a,{x:28,y:10,width:800,height:800});if("top"===d||"bottom"===d)a.vy*=-1;if("left"===d||"right"===d)a.vx*=-1;infecteds.forEach(function(b){hitTestRectangle(a,
    b,Radius)&&bump&&(a.vx*=-1,a.vy*=-1,b.vx*=-1,b.vy*=-1)});healthys.forEach(function(b,c,d){if(hitTestRectangle(a,b,Radius)){if(transmission()){var e=new Sprite(id["infected.png"]);e.x=b.x;e.y=b.y;e.vy=b.vy;e.vx=b.vx;e.infection=infectionLength;infecteds.push(e);d.splice(c,1);gameScene.addChild(e);gameScene.removeChild(b)}bump&&(a.vx*=-1,a.vy*=-1,b.vx*=-1,b.vy*=-1);healtys=d}});a.infection--;a.infection||(mortality()?(d=new Sprite(id["explorer.png"]),d.x=a.x,d.y=a.y,d.vx=0,d.vy=0,mortals.push(d),c.splice(b,
    1),gameScene.addChild(d)):(d=new Sprite(id["immune.png"]),d.x=a.x,d.y=a.y,d.vy=a.vy,d.vx=a.vx,d.infection=30,immunes.push(d),c.splice(b,1),gameScene.addChild(d)),gameScene.removeChild(a));infecteds=c});immunes.forEach(function(a){a.y+=a.vy;a.x+=a.vx;var b=contain(a,{x:28,y:10,width:800,height:800});if("top"===b||"bottom"===b)a.vy*=-1;if("left"===b||"right"===b)a.vx*=-1;immunes.forEach(function(b){hitTestRectangle(a,b,Radius)&&bump&&(a.vx*=-1,a.vy*=-1,b.vx*=-1,b.vy*=-1)});healthys.forEach(function(b){hitTestRectangle(a,
    b,Radius)&&bump&&(a.vx*=-1,a.vy*=-1,b.vx*=-1,b.vy*=-1)});infecteds.forEach(function(b){hitTestRectangle(a,b,Radius)&&bump&&(a.vx*=-1,a.vy*=-1,b.vx*=-1,b.vy*=-1)})});explorer.alpha=1;0==infecteds.length&&(state=end);sample||(sample=30,healthyset[timeline]={t:timeline,y:healthys.length},infectedset[timeline]={t:timeline,y:infecteds.length},immuneset[timeline]={t:timeline,y:immunes.length},mortalset[timeline]={t:timeline,y:mortals.length},$("#phealthy").text(healthys.length),$("#pinfected").text(infecteds.length),
    $("#pimmune").text(immunes.length),$("#pmortal").text(mortals.length),xvalsSim[timeline]=timeline,0<timeline&&(healthyperc[timeline]={t:timeline,y:perc(healthyset[timeline].y,healthyset[timeline-1].y)},immuneperc[timeline]={t:timeline,y:perc(immuneset[timeline].y,immuneset[timeline-1].y)},infectedperc[timeline]={t:timeline,y:perc(infectedset[timeline].y,infectedset[timeline-1].y)},mortalperc[timeline]={t:timeline,y:perc(mortalset[timeline].y,mortalset[timeline-1].y)},absperc[timeline]={t:timeline,
    y:perc(mortalset[timeline].y+immuneset[timeline].y+infectedset[timeline].y,mortalset[timeline-1].y+immuneset[timeline-1].y+infectedset[timeline-1].y)},window.myLineP.update()),window.myLine.update(),timeline++)}function perc(e,a){return 100*(e-a)}function end(){}function transmission(){return Math.random()<transmissibility/100}function mortality(){return Math.random()<mortalityRate/100}
function contain(e,a){var b=void 0;e.x<a.x&&(e.x=a.x,b="left");e.y<a.y&&(e.y=a.y,b="top");e.x+e.width>a.width&&(e.x=a.width-e.width,b="right");e.y+e.height>a.height&&(e.y=a.height-e.height,b="bottom");return b}
function hitTestRectangle(e,a,b){e.centerX=e.x+e.width/2;e.centerY=e.y+e.height/2;a.centerX=a.x+a.width/2;a.centerY=a.y+a.height/2;e.halfWidth=e.width/2;e.halfHeight=e.height/2;a.halfWidth=a.width/2;a.halfHeight=a.height/2;dist=Math.sqrt(Math.pow(e.centerX-a.centerX,2)+Math.pow(e.centerY-a.centerY,2));return dist<b}function randomInt(e,a){var b=Math.random();0===b&&(b=1);return Math.floor(b*(a-e+1))+e}
function keyboard(e){var a={};a.code=e;a.isDown=!1;a.isUp=!0;a.press=void 0;a.release=void 0;a.downHandler=function(b){b.keyCode===a.code&&(a.isUp&&a.press&&a.press(),a.isDown=!0,a.isUp=!1);b.preventDefault()};a.upHandler=function(b){b.keyCode===a.code&&(a.isDown&&a.release&&a.release(),a.isDown=!1,a.isUp=!0);b.preventDefault()};window.addEventListener("keydown",a.downHandler.bind(a),!1);window.addEventListener("keyup",a.upHandler.bind(a),!1);return a}
var configsim={type:"line",data:{labels:xvalsSim,datasets:[{label:"Immune",borderColor:"#a4c15b",backgroundColor:"#c6d899",data:immuneset},{label:"Infected",borderColor:"#FF0000",backgroundColor:"#FFaf30",data:infectedset},{label:"Susceptible",borderColor:"#4383cc",backgroundColor:"#8ab2df",data:healthyset},{label:"Victim",borderColor:"#505050",backgroundColor:"#f0f0f0",data:mortalset}]},options:{responsive:!0,title:{display:!0,text:"Population Changes"},tooltips:{mode:"index"},hover:{mode:"index"},
        scales:{xAxes:[{distribution:"series",offset:!0,labelString:"Epoch",ticks:{major:{enabled:!0,fontStyle:"bold"},source:"data",autoSkip:!0,autoSkipPadding:75,maxRotation:0,sampleSize:100}}],yAxes:[{stacked:!1,scaleLabel:{display:!0,labelString:"Population"}}]}}},configperc={type:"line",data:{labels:xvalsSim,datasets:[{label:"Immune",borderColor:"#a4c15b",backgroundColor:"#c6d899",data:immuneperc},{label:"Infected",borderColor:"#FF0000",backgroundColor:"#FFaf30",data:infectedperc},{label:"Susceptible",
            borderColor:"#4383cc",backgroundColor:"#8ab2df",data:healthyperc},{label:"Victim",borderColor:"#505050",backgroundColor:"#f0f0f0",data:mortalperc},{label:"Total Case % Change",borderColor:"#ffcc00",backgroundColor:"#ffffcc",data:absperc}]},options:{responsive:!0,title:{display:!0,text:"Percent Population Changes"},tooltips:{mode:"index"},hover:{mode:"index"},scales:{xAxes:[{distribution:"series",offset:!0,labelString:"Epoch",ticks:{major:{enabled:!0,fontStyle:"bold"},source:"data",autoSkip:!0,autoSkipPadding:75,
                    maxRotation:0,sampleSize:100}}],yAxes:[{stacked:!1,scaleLabel:{display:!0,labelString:"Population"}}]}}};function isQuarantined(){return Math.random()<quarantineLevel/100}var ctxx=document.getElementById("canvassim").getContext("2d");window.myLine=new Chart(ctxx,configsim);var ctxp=document.getElementById("canvasperc").getContext("2d");window.myLineP=new Chart(ctxp,configperc);
$("#runsimulation").click(function(){$("#graphholder").html("<h1>Resetting...</h1>");window.myLine.destroy();window.myLineP.destroy();bump=$("#isBounce").is(":checked");populations=$("#slider-range-min").slider("value");transmissibility=$("#transmissibility").slider("value");socialSpeed=$("#movementspd").slider("value")/100;quarantineLevel=$("#shelter").slider("value");Radius=$("#radius").slider("value");infectionLength=30*$("#infectionTime").slider("value");mortalityRate=$("#mortality").slider("value");
    naturalImmunity=$("#amountimm").slider("value");riskpop=$("#amountinf").slider("value");$("#graphholder").html('<canvas id="canvasperc"></canvas><canvas id="canvassim"></canvas>');app.destroy(!0);app=null;loader.reset();app=new Application({width:810,height:810,antialiasing:!0,transparent:!1,resolution:1});healthyset=[];immuneset=[];infectedset=[];mortalset=[];healthyperc=[];immuneperc=[];infectedperc=[];mortalperc=[];xvalsSim=[];timeline=0;var e={type:"line",data:{labels:xvalsSim,datasets:[{label:"Victim",
                    borderColor:"#101010",backgroundColor:"#f0f0f0",data:mortalset},{label:"Immune",borderColor:"#a4c15b",backgroundColor:"#c6d899",data:immuneset},{label:"Infected",borderColor:"#FF0000",backgroundColor:"#FFaf30",data:infectedset},{label:"Healthy",borderColor:"#4383cc",backgroundColor:"#8ab2df",data:healthyset}]},options:{responsive:!0,title:{display:!0,text:"Population Changes"},tooltips:{mode:"index"},hover:{mode:"index"},scales:{xAxes:[{distribution:"series",offset:!0,labelString:"Epoch",ticks:{major:{enabled:!0,
                                fontStyle:"bold"},source:"data",autoSkip:!0,autoSkipPadding:75,maxRotation:0,sampleSize:100}}],yAxes:[{stacked:!1,scaleLabel:{display:!0,labelString:"Population"}}]}}},a={type:"line",data:{labels:xvalsSim,datasets:[{label:"Immune",borderColor:"#a4c15b",backgroundColor:"#c6d899",data:immuneperc},{label:"Infected",borderColor:"#FF0000",backgroundColor:"#FFaf30",data:infectedperc},{label:"Susceptible",borderColor:"#4383cc",backgroundColor:"#8ab2df",data:healthyperc},{label:"Victim",borderColor:"#505050",
                    backgroundColor:"#f0f0f0",data:mortalperc},{label:"Total Case % Change",borderColor:"#ffcc00",backgroundColor:"#ffffcc",data:absperc}]},options:{responsive:!0,title:{display:!0,text:"Population Changes"},tooltips:{mode:"index"},hover:{mode:"index"},scales:{xAxes:[{distribution:"series",offset:!0,labelString:"Epoch",ticks:{major:{enabled:!0,fontStyle:"bold"},source:"data",autoSkip:!0,autoSkipPadding:75,maxRotation:0,sampleSize:100}}],yAxes:[{stacked:!1,scaleLabel:{display:!0,labelString:"Population"}}]}}},
        b=document.getElementById("canvassim").getContext("2d");window.myLine=new Chart(b,e);e=document.getElementById("canvasperc").getContext("2d");window.myLineP=new Chart(e,a);renderScene()});$(function(){var e=$("#custom-handle");$("#slider-range-min").slider({range:"min",value:200,min:50,max:800,create:function(){e.text($(this).slider("value"))},slide:function(a,b){$("#amount").val(b.value);e.text(b.value)}});$("#amount").val(+$("#slider-range-min").slider("value"))});
$(function(){var e=$("#transmissibility-handle");$("#transmissibility").slider({range:"min",value:70,min:1,max:100,create:function(){e.text($(this).slider("value"))},slide:function(a,b){$("#transmissibility-label").val("% "+b.value);e.text("%"+b.value)}});$("#transmissibility-label").val("% "+$("#transmissibility").slider("value"))});
$(function(){var e=$("#movementspd-handle");$("#movementspd").slider({range:"min",value:100,min:1,max:200,create:function(){e.text($(this).slider("value"))},slide:function(a,b){$("#movementspd-label").val("% "+b.value);e.text("%"+b.value)}});$("#movementspd-label").val("% "+$("#movementspd").slider("value"))});
$(function(){var e=$("#shelter-handle");$("#shelter").slider({range:"min",value:0,min:0,max:100,create:function(){e.text($(this).slider("value"))},slide:function(a,b){$("#shelter-label").val("% "+b.value);e.text("%"+b.value)}});$("#shelter-label").val("% "+$("#shelter").slider("value"))});
$(function(){var e=$("#radius-handle");$("#radius").slider({range:"min",value:10,min:1,max:20,create:function(){e.text($(this).slider("value"))},slide:function(a,b){$("#radius-label").val(b.value);e.text(b.value)}});$("#radius-label").val($("#radius").slider("value"))});
$(function(){var e=$("#infectionTime-handle");$("#infectionTime").slider({range:"min",value:10,min:1,max:30,create:function(){e.text($(this).slider("value"))},slide:function(a,b){$("#infectionTime-label").val(b.value);e.text(b.value)}});$("#infectionTime-label").val($("#infectionTime").slider("value"))});
$(function(){var e=$("#mortality-handle");$("#mortality").slider({range:"min",value:3,min:0,max:100,create:function(){e.text($(this).slider("value"))},slide:function(a,b){$("#mortality-label").val(b.value);e.text(b.value)}});$("#mortality-label").val($("#mortality").slider("value"))});
$(function(){var e=$("#amountimm-handle");$("#amountimm").slider({range:"min",value:1,min:0,max:400,create:function(){e.text($(this).slider("value"))},slide:function(a,b){$("#amountimm-label").val(b.value);e.text(b.value)}});$("#amountimm-label").val($("#amountimm").slider("value"))});
$(function(){var e=$("#amountinf-handle");$("#amountinf").slider({range:"min",value:1,min:1,max:100,create:function(){e.text($(this).slider("value"))},slide:function(a,b){$("#amountinf-label").val(b.value);e.text(b.value)}});$("#amountinf-label").val($("#amountinf").slider("value"))});
function md5cycle(e,a){var b=e[0],c=e[1],d=e[2],f=e[3];b=ff(b,c,d,f,a[0],7,-680876936);f=ff(f,b,c,d,a[1],12,-389564586);d=ff(d,f,b,c,a[2],17,606105819);c=ff(c,d,f,b,a[3],22,-1044525330);b=ff(b,c,d,f,a[4],7,-176418897);f=ff(f,b,c,d,a[5],12,1200080426);d=ff(d,f,b,c,a[6],17,-1473231341);c=ff(c,d,f,b,a[7],22,-45705983);b=ff(b,c,d,f,a[8],7,1770035416);f=ff(f,b,c,d,a[9],12,-1958414417);d=ff(d,f,b,c,a[10],17,-42063);c=ff(c,d,f,b,a[11],22,-1990404162);b=ff(b,c,d,f,a[12],7,1804603682);f=ff(f,b,c,d,a[13],12,
    -40341101);d=ff(d,f,b,c,a[14],17,-1502002290);c=ff(c,d,f,b,a[15],22,1236535329);b=gg(b,c,d,f,a[1],5,-165796510);f=gg(f,b,c,d,a[6],9,-1069501632);d=gg(d,f,b,c,a[11],14,643717713);c=gg(c,d,f,b,a[0],20,-373897302);b=gg(b,c,d,f,a[5],5,-701558691);f=gg(f,b,c,d,a[10],9,38016083);d=gg(d,f,b,c,a[15],14,-660478335);c=gg(c,d,f,b,a[4],20,-405537848);b=gg(b,c,d,f,a[9],5,568446438);f=gg(f,b,c,d,a[14],9,-1019803690);d=gg(d,f,b,c,a[3],14,-187363961);c=gg(c,d,f,b,a[8],20,1163531501);b=gg(b,c,d,f,a[13],5,-1444681467);
    f=gg(f,b,c,d,a[2],9,-51403784);d=gg(d,f,b,c,a[7],14,1735328473);c=gg(c,d,f,b,a[12],20,-1926607734);b=hh(b,c,d,f,a[5],4,-378558);f=hh(f,b,c,d,a[8],11,-2022574463);d=hh(d,f,b,c,a[11],16,1839030562);c=hh(c,d,f,b,a[14],23,-35309556);b=hh(b,c,d,f,a[1],4,-1530992060);f=hh(f,b,c,d,a[4],11,1272893353);d=hh(d,f,b,c,a[7],16,-155497632);c=hh(c,d,f,b,a[10],23,-1094730640);b=hh(b,c,d,f,a[13],4,681279174);f=hh(f,b,c,d,a[0],11,-358537222);d=hh(d,f,b,c,a[3],16,-722521979);c=hh(c,d,f,b,a[6],23,76029189);b=hh(b,c,
        d,f,a[9],4,-640364487);f=hh(f,b,c,d,a[12],11,-421815835);d=hh(d,f,b,c,a[15],16,530742520);c=hh(c,d,f,b,a[2],23,-995338651);b=ii(b,c,d,f,a[0],6,-198630844);f=ii(f,b,c,d,a[7],10,1126891415);d=ii(d,f,b,c,a[14],15,-1416354905);c=ii(c,d,f,b,a[5],21,-57434055);b=ii(b,c,d,f,a[12],6,1700485571);f=ii(f,b,c,d,a[3],10,-1894986606);d=ii(d,f,b,c,a[10],15,-1051523);c=ii(c,d,f,b,a[1],21,-2054922799);b=ii(b,c,d,f,a[8],6,1873313359);f=ii(f,b,c,d,a[15],10,-30611744);d=ii(d,f,b,c,a[6],15,-1560198380);c=ii(c,d,f,b,a[13],
        21,1309151649);b=ii(b,c,d,f,a[4],6,-145523070);f=ii(f,b,c,d,a[11],10,-1120210379);d=ii(d,f,b,c,a[2],15,718787259);c=ii(c,d,f,b,a[9],21,-343485551);e[0]=add32(b,e[0]);e[1]=add32(c,e[1]);e[2]=add32(d,e[2]);e[3]=add32(f,e[3])}function cmn(e,a,b,c,d,f){a=add32(add32(a,e),add32(c,f));return add32(a<<d|a>>>32-d,b)}function ff(e,a,b,c,d,f,g){return cmn(a&b|~a&c,e,a,d,f,g)}function gg(e,a,b,c,d,f,g){return cmn(a&c|b&~c,e,a,d,f,g)}function hh(e,a,b,c,d,f,g){return cmn(a^b^c,e,a,d,f,g)}
function ii(e,a,b,c,d,f,g){return cmn(b^(a|~c),e,a,d,f,g)}function md51(e){txt="";var a=e.length,b=[1732584193,-271733879,-1732584194,271733878],c;for(c=64;c<=e.length;c+=64)md5cycle(b,md5blk(e.substring(c-64,c)));e=e.substring(c-64);var d=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(c=0;c<e.length;c++)d[c>>2]|=e.charCodeAt(c)<<(c%4<<3);d[c>>2]|=128<<(c%4<<3);if(55<c)for(md5cycle(b,d),c=0;16>c;c++)d[c]=0;d[14]=8*a;md5cycle(b,d);return b}
function md5blk(e){var a=[],b;for(b=0;64>b;b+=4)a[b>>2]=e.charCodeAt(b)+(e.charCodeAt(b+1)<<8)+(e.charCodeAt(b+2)<<16)+(e.charCodeAt(b+3)<<24);return a}var hex_chr="0123456789abcdef".split("");function rhex(e){for(var a="",b=0;4>b;b++)a+=hex_chr[e>>8*b+4&15]+hex_chr[e>>8*b&15];return a}function hex(e){for(var a=0;a<e.length;a++)e[a]=rhex(e[a]);return e.join("")}function md5(e){return hex(md51(e))}function add32(e,a){return e+a&4294967295}renderScene();